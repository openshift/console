import type { FC } from 'react';
import { ExclamationTriangleIcon } from '@patternfly/react-icons/dist/esm/icons/exclamation-triangle-icon';
import { css } from '@patternfly/react-styles';
import { RowFunctionArgs, TableData } from '@console/internal/components/factory';
import { ExternalLink } from '@console/shared/src/components/links/ExternalLink';
import { priorityFor } from '../const';
import { Feature, Vulnerability } from '../types';
import { getVulnerabilitySource, getVulnerabilityType } from './image-vulnerability-utils';

type ImageVulnerabilityRowProps = {
  vulnerability: Vulnerability;
  feature: Feature;
};

export const imageVulnerabilitiesTableColumnClasses = [
  '',
  '',
  css('pf-m-hidden', 'pf-m-visible-on-md'),
  css('pf-m-hidden', 'pf-m-visible-on-md'),
  css('pf-m-hidden', 'pf-m-visible-on-lg'),
  css('pf-m-hidden', 'pf-m-visible-on-xl'),
  css('pf-m-hidden', 'pf-m-visible-on-xl'),
];

const ImageVulnerabilityRow: FC<RowFunctionArgs<ImageVulnerabilityRowProps>> = (props) => {
  const {
    obj: { vulnerability, feature },
  } = props;
  return (
    <>
      <TableData className={imageVulnerabilitiesTableColumnClasses[0]}>
        <ExternalLink text={vulnerability.name} href={vulnerability.link} />
      </TableData>
      <TableData className={imageVulnerabilitiesTableColumnClasses[1]}>
        <ExclamationTriangleIcon color={priorityFor(vulnerability.severity).color.value} />
        &nbsp;{vulnerability.severity}
      </TableData>
      <TableData className={imageVulnerabilitiesTableColumnClasses[2]}>{feature.name}</TableData>
      <TableData className={imageVulnerabilitiesTableColumnClasses[3]}>
        {getVulnerabilityType(vulnerability)}
      </TableData>
      <TableData className={imageVulnerabilitiesTableColumnClasses[4]}>
        {getVulnerabilitySource(vulnerability)}
      </TableData>
      <TableData className={imageVulnerabilitiesTableColumnClasses[5]}>{feature.version}</TableData>
      <TableData className={imageVulnerabilitiesTableColumnClasses[6]}>
        {vulnerability.fixedby || '-'}
      </TableData>
    </>
  );
};

export default ImageVulnerabilityRow;
